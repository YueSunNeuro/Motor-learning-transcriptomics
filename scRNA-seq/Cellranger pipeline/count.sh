#!/bin/bash
#SBATCH --job-name=mkfastq_sample         # SLURM job name (appears in queue)
#SBATCH --output=mkfastq_sample.out       # File for standard output
#SBATCH --error=mkfastq_sample.err        # File for standard error
#SBATCH --time=6:00:00                    # Max run time (hh:mm:ss)
#SBATCH --cpus-per-task=16                # Number of CPUs
#SBATCH --mem=64G                         # Memory allocation (in GB)

# -------------------------------------------
# Description:
# Runs `cellranger count` to align reads, quantify genes,
# and generate feature-barcode matrices using a custom reference.
#
# Example:
# - Sample: "sample"
# - Run folder: HVYK3BBXX
# - Reference: Ai9-WPRE (e.g., tdTomato or WPRE added)
#
# Requirements:
# - Cell Ranger 3.0.2 installed
# - FASTQ files generated by `cellranger mkfastq`
# - Reference built with `cellranger mkref`
# -------------------------------------------

# Load necessary environment (update if needed for your cluster)
module load biology

# Add Cell Ranger to PATH (update to actual installation path)
export PATH=$PATH:/path/to/cellranger-3.0.2

# Run cellranger count
cellranger count \
  --id=count_out \                                # Output folder name
  --transcriptome=/cellranger_Ai9-WPRE \          # Path to custom reference
  --fastqs=/sample-out/fastq_path/HVYK3BBXX \     # Path to FASTQ directory
  --sample=sample                                 # Sample name from sample sheet / FASTQ
